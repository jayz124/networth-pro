// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model Account {
  id         Int      @id @default(autoincrement())
  name       String   @unique
  institution String?
  type       String
  currency   String   @default("USD")
  tags       String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  balance_snapshots BalanceSnapshot[]
  transactions      Transaction[]

  @@map("account")
}

model Liability {
  id         Int      @id @default(autoincrement())
  name       String   @unique
  category   String?
  currency   String   @default("USD")
  tags       String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  balance_snapshots BalanceSnapshot[]

  @@map("liability")
}

model Portfolio {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  currency    String   @default("USD")
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  holdings PortfolioHolding[]

  @@map("portfolio")
}

model PortfolioHolding {
  id             Int       @id @default(autoincrement())
  portfolio_id   Int
  portfolio      Portfolio @relation(fields: [portfolio_id], references: [id], onDelete: Cascade)
  ticker         String
  asset_type     String
  quantity       Float
  purchase_price Float?
  purchase_date  String?
  currency       String    @default("USD")
  current_price  Float?
  current_value  Float?
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  @@map("portfolioholding")
}

model BalanceSnapshot {
  id           Int        @id @default(autoincrement())
  date         DateTime
  account_id   Int?
  account      Account?   @relation(fields: [account_id], references: [id], onDelete: Cascade)
  liability_id Int?
  liability    Liability? @relation(fields: [liability_id], references: [id], onDelete: Cascade)
  amount       Float
  currency     String
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  @@index([date])
  @@index([account_id, date])
  @@index([liability_id, date])
  @@map("balancesnapshot")
}

model SecurityInfo {
  id           Int      @id @default(autoincrement())
  ticker       String   @unique
  name         String
  asset_type   String
  exchange     String?
  currency     String   @default("USD")
  sector       String?
  last_updated DateTime
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  @@map("securityinfo")
}

model PriceCache {
  id             Int      @id @default(autoincrement())
  ticker         String
  current_price  Float
  previous_close Float?
  change_percent Float?
  fetched_at     DateTime
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  @@index([ticker])
  @@map("pricecache")
}

model Property {
  id                   Int      @id @default(autoincrement())
  name                 String
  address              String
  property_type        String
  purchase_price       Float
  purchase_date        String?
  current_value        Float
  currency             String   @default("USD")
  provider_property_id String?
  valuation_provider   String?
  created_at           DateTime @default(now())
  updated_at           DateTime @updatedAt

  mortgages     Mortgage[]
  valuations    PropertyValuationCache[]
  value_history PropertyValueHistory[]

  @@map("property")
}

model PropertyValuationCache {
  id                     Int      @id @default(autoincrement())
  property_id            Int
  property               Property @relation(fields: [property_id], references: [id], onDelete: Cascade)
  provider               String   @default("rentcast")
  provider_property_id   String?
  estimated_value        Float
  estimated_rent_monthly Float?
  confidence             String?
  value_range_low        Float?
  value_range_high       Float?
  rent_range_low         Float?
  rent_range_high        Float?
  bedrooms               Int?
  bathrooms              Float?
  square_footage         Int?
  year_built             Int?
  currency               String   @default("USD")
  fetched_at             DateTime
  created_at             DateTime @default(now())
  updated_at             DateTime @updatedAt

  @@index([property_id])
  @@map("propertyvaluationcache")
}

model PropertyValueHistory {
  id              Int      @id @default(autoincrement())
  property_id     Int
  property        Property @relation(fields: [property_id], references: [id], onDelete: Cascade)
  date            DateTime
  estimated_value Float
  source          String   @default("rentcast")
  currency        String   @default("USD")
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  @@index([property_id])
  @@index([date])
  @@map("propertyvaluehistory")
}

model Mortgage {
  id                 Int      @id @default(autoincrement())
  property_id        Int
  property           Property @relation(fields: [property_id], references: [id], onDelete: Cascade)
  lender             String?
  original_principal Float
  current_balance    Float
  interest_rate      Float
  monthly_payment    Float
  term_years         Int
  is_active          Boolean  @default(true)
  created_at         DateTime @default(now())
  updated_at         DateTime @updatedAt

  @@map("mortgage")
}

model RetirementPlan {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  mode        String
  config_json String
  is_active   Boolean  @default(false)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  @@map("retirementplan")
}

model BudgetCategory {
  id           Int      @id @default(autoincrement())
  name         String   @unique
  icon         String?
  color        String?
  budget_limit Float?
  is_income    Boolean  @default(false)
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  transactions  Transaction[]
  subscriptions Subscription[]

  @@map("budgetcategory")
}

model Transaction {
  id                   Int             @id @default(autoincrement())
  date                 DateTime
  description          String
  amount               Float
  category_id          Int?
  category             BudgetCategory? @relation(fields: [category_id], references: [id], onDelete: SetNull)
  account_id           Int?
  account              Account?        @relation(fields: [account_id], references: [id], onDelete: SetNull)
  is_recurring         Boolean         @default(false)
  merchant             String?
  notes                String?
  ai_categorized       Boolean         @default(false)
  recurrence_frequency String?
  created_at           DateTime @default(now())
  updated_at           DateTime @updatedAt

  @@index([date])
  @@map("transaction")
}

model Subscription {
  id                Int             @id @default(autoincrement())
  name              String
  amount            Float
  frequency         String
  category_id       Int?
  category          BudgetCategory? @relation(fields: [category_id], references: [id], onDelete: SetNull)
  next_billing_date DateTime?
  is_active         Boolean         @default(true)
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt

  @@map("subscription")
}

model NetWorthSnapshot {
  id                Int      @id @default(autoincrement())
  date              String   @unique
  total_cash        Float    @default(0.0)
  total_investments Float    @default(0.0)
  total_real_estate Float    @default(0.0)
  total_liabilities Float    @default(0.0)
  total_mortgages   Float    @default(0.0)
  net_worth         Float    @default(0.0)
  created_at        DateTime @default(now())

  @@map("networthsnapshot")
}

model PlaidItem {
  id               Int      @id @default(autoincrement())
  item_id          String   @unique
  access_token     String
  institution_name String?
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt

  @@map("plaiditem")
}

model AppSettings {
  id         Int      @id @default(autoincrement())
  key        String   @unique
  value      String?
  is_secret  Boolean  @default(false)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("appsettings")
}
